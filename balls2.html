<!DOCTYPE html>
<html>
  <head>
    <title>Basic Three.js App</title>
    <style>
      html, body { margin: 0; padding: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/102/three.min.js"></script>
	<script src="Orbitcontrols.js"></script>
	
    <script>
		var time = 0
		var scene = new THREE.Scene();
		var aspect = window.innerWidth / window.innerHeight;
		var camera = new THREE.PerspectiveCamera( 75, aspect, 0.1, 1000 );
		var renderer = new THREE.WebGLRenderer();
		var controls = new THREE.OrbitControls( camera );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );
		var loader = new THREE.TextureLoader();
				
		var suntexture = loader.load("sun.jpg");
        var suntexture2 = loader.load("maduro.jpg");
		
		
		var sun_material = new THREE.MeshPhongMaterial({
		  color: 0xaaaaaa,
		  specular: 0x333333,
		  shininess: 15,
		  map: suntexture		  
		});		
		
		
		var sun_material2 = new THREE.MeshPhongMaterial({
		  color: 0xaaaaaa,
		  specular: 0x333333,
		  shininess: 15,
		  map: suntexture2		  
		});		
		//Sun
        var sunRadio = 2;
		var geometrysun = new THREE.SphereGeometry( 2, 40, 40 );
		var sun = new THREE.Mesh(geometrysun, sun_material);
        sun.position.y = 30
		sun.position.x = -40
		scene.add(sun)

        var geometrypared = new THREE.BoxGeometry( 40, 1, 40 );
        var material = new THREE.MeshNormalMaterial();
        var wall1 = new THREE.Mesh(geometrypared, material)
        wall1.position.x = -40
        wall1.position.y = (Math.random() * 40 ) - 20
        scene.add(wall1)

		var finalx = 0
		for (var i = 1; i<= 50; i++){
					
			var geometrypared2 = new THREE.BoxGeometry( 40, 1, 40 );
			var material2 = new THREE.MeshNormalMaterial();
			var wall2 = new THREE.Mesh(geometrypared2, material2)
			wall2.position.x = (100 * i)
			wall2.position.y = (Math.random() * 40 ) - 20
			wall2.position.z = 0
			scene.add(wall2)
			finalx = wall2.position.x
		}
		
        var geometrypared3 = new THREE.BoxGeometry( 1, 80, 40 );
        var material3 = new THREE.MeshNormalMaterial();
        var wall3 = new THREE.Mesh(geometrypared3, material3)
        wall3.position.x = finalx + 20
        wall3.position.y = 20
        scene.add(wall3)

        var geometrypared4 = new THREE.BoxGeometry( 1, 80, 40 );
        var material4 = new THREE.MeshNormalMaterial();
        var wall4 = new THREE.Mesh(geometrypared4, material4)
        wall4.position.x = -60
        wall4.position.y = 20
        scene.add(wall4)



		//Camera & Light
		camera.position.z = 200;
        camera.position.x = -20;
		camera.position.y = 40
		var light = new THREE.AmbientLight(0xffffff);
		
		
        let g_aceletation = [0,-9.81,0]
        var speed = [0,0,0]
        var speed2 = [0,0,0]
        var timelap = 0.05
        var timelap2 = 0.04
		scene.add(light)
		var passed = 0;
				
		
		var render = function () {
			requestAnimationFrame( render );
			controls.update();
						

            speed[0] += g_aceletation[0] * timelap 
            speed[1] += g_aceletation[1] * timelap
            speed[2] += g_aceletation[2] * timelap

			sun.position.x += speed[0] * timelap;
            sun.position.y += speed[1] * timelap;
            sun.position.z += speed[2] * timelap;
            time += timelap
			
            let raycaster = new THREE.Raycaster();
            raycaster.set(sun.position, new THREE.Vector3(0,-1.0,0));
            let intersects = raycaster.intersectObjects(scene.children, true);

            let raycaster2 = new THREE.Raycaster();
            raycaster2.set(sun.position, new THREE.Vector3(1,0,0));
            let intersects2 = raycaster2.intersectObjects(scene.children, true);

            let raycaster3 = new THREE.Raycaster();
            raycaster3.set(sun.position, new THREE.Vector3(-1,0,0));
            let intersects3 = raycaster3.intersectObjects(scene.children, true);
			
			let raycaster4 = new THREE.Raycaster();
            raycaster4.set(sun.position, new THREE.Vector3(0,1,0));
            let intersects4 = raycaster4.intersectObjects(scene.children, true);
			
			let raycaster5 = new THREE.Raycaster();
            raycaster5.set(sun.position, new THREE.Vector3(1,-1,0));
            let intersects5 = raycaster5.intersectObjects(scene.children, true);
			
			let raycaster6 = new THREE.Raycaster();
            raycaster6.set(sun.position, new THREE.Vector3(-1,-1,0));
            let intersects6 = raycaster6.intersectObjects(scene.children, true);

            if(intersects.length > 0){
                if(intersects[0].distance < sunRadio){
					speed[1] = 27.468000000000032
                    //speed[1] = Math.abs(speed[1] * 1.0);
					passed++;
					textnumber(passed)
                 }
            }
			
			if(intersects4.length > 0){
                if(intersects4[0].distance < sunRadio){
					speed[1] = Math.abs(speed[1]) * -1;					
                 }
            }
			
			if(intersects5.length > 0){
                if(intersects5[0].distance < sunRadio){
					speed[1] = 27.468000000000032
					passed++;
					textnumber(passed)
					//speed[1] = Math.abs(speed[1]) * -1;					
                 }
            }
			
			if(intersects6.length > 0){
                if(intersects6[0].distance < sunRadio){
					speed[1] = 27.468000000000032
					passed++;
					//speed[1] = Math.abs(speed[1]) * -1;					
                 }
            }

            if(sun.position.x - wall3.position.x > -sunRadio){
                    speed[0] = -Math.abs(speed[0]);
                }
            
            if(sun.position.x - wall4.position.x < sunRadio){
                    speed[0] = Math.abs(speed[0]);
                    
                }

            
            camera.position.x = sun.position.x
			camera.position.z = 200
			camera.lookAt(sun.position)
			renderer.render( scene, camera );
		};
		render();
		
		document.addEventListener("keydown", onDocumentKeyDown, false);		
		function onDocumentKeyDown(event) {
			var keyCode = event.which;
			if (keyCode == 87) { // W
				camera.position.z -= 1;
			} else if (keyCode == 83) { //S
				camera.position.z += 1;
			} else if (keyCode == 65) { // A
				//sun.position.x -= 1;
                speed[0] -= 1
                speed2[0] += 1
			} else if (keyCode == 68) { // D
				//sun.position.x += 1;
                speed[0] += 1
                speed2[0]-=1
			} else if (keyCode == 69) { // E
				camera.position.y -= 1;
			} else if (keyCode == 81) { // Q
				camera.position.y += 1;
			} else if (keyCode == 90) { // Z
				camera.rotation.y += 0.01;
			} else if (keyCode == 67) { // C 
				camera.rotation.y -= 0.01;
			}
		};	

        function distanceVector( v1, v2 )
        {
            var dx = v1.x - v2.x;
            var dy = v1.y - v2.y;
            var dz = v1.z - v2.z;

            return Math.sqrt( dx * dx + dy * dy + dz * dz );
        }
    </script>
  </body>
</html>